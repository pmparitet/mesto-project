(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>F});var t=function(e,t,n,o){switch(n.disabled=t,e){case"add":n.classList.add(o);break;case"remove":n.classList.remove(o);break;default:console.log("changeButtonClass-default")}},n=function(e,n,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?t("remove",!1,o,e.inactiveButtonClass):t("add",!0,o,e.inactiveButtonClass)};function o(e){"Escape"===e.key&&c(document.querySelector(".popup_opened"))}function r(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function c(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}function a(e,t){e.target.classList.contains("popup_opened")&&c(t)}var u={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"f573e011-92da-4150-bd2f-6bf7fb5dd4b1","Content-Type":"application/json"}},i=function(e){return fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},s=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},l=function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},d=document.querySelector(".main"),p=d.querySelector(".profile__edit-button"),f=d.querySelector(".profile__add-button"),m=document.querySelector("#editForm"),_=document.querySelector("#addCardForm"),v=_.querySelector(".popup__field[name='nameInput']"),h=_.querySelector(".popup__field[name='urlInput']"),y=_.querySelector(".popup__submit-button"),b=document.querySelector("#img-popup"),S=b.querySelector(".popup__image"),k=b.querySelector(".popup__image-name"),C=d.querySelector(".profile__title"),q=d.querySelector(".profile__subtitle"),L=m.querySelector(".popup__field[name='nameInput']"),E=m.querySelector(".popup__field[name='jobeInput']"),g=m.querySelector(".popup__submit-button"),x=m.querySelector(".popup__close-button"),j=_.querySelector(".popup__close-button"),P=b.querySelector(".popup__close-button"),U=d.querySelector(".profile__overlay"),A=U.querySelector(".profile__avatar"),O=document.querySelector("#editAvatar"),T=O.querySelector(".popup__field[name='avatarUrlInput']"),w=O.querySelector(".popup__close-button"),B=O.querySelector(".popup__submit-button"),I=document.querySelector("#card-template").content,D=document.querySelector(".elements");function N(e){e.classList.add("element__like-btn_active")}function J(e,t){var n=function(e){var t=I.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__mask-group"),o=t.querySelector(".element__title"),c=t.querySelector(".element__like-btn"),a=t.querySelector(".element__delete-btn"),u=t.querySelector(".element__like-count");return n.setAttribute("src",e.link),n.setAttribute("alt",e.name),o.textContent=e.name,u.textContent=e.likes.length,console.log("card",e),function(e){return e.likes.map((function(e){return e._id})).includes(F)}(e)&&N(c),c.addEventListener("click",(function(){c.classList.contains("element__like-btn_active")?function(e,t,n){l(e).then((function(e){!function(e){e.classList.remove("element__like-btn_active")}(t),n.textContent=e.likes.length})).catch((function(e){console.log(e,t)}))}(e._id,c,u):function(e,t,n){s(e).then((function(e){N(t),n.textContent=e.likes.length})).catch((function(e){console.log(e,t)}))}(e._id,c,u)})),F===e.owner._id?a.addEventListener("click",(function(){i(e._id).then((function(){t.remove()})).catch((function(e){console.log(e)}))})):a.classList.add("element__delete-btn_hidden"),n.addEventListener("click",(function(){var e,t;e=n,t=o,S.src="",S.alt="",k.textContent="",S.src=e.src,S.alt=e.alt,k.textContent=t.textContent,r(b)})),t}(e);switch(t){case"append":D.append(n);break;case"prepend":D.prepend(n)}}var M,F="";fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){C.textContent=e.name,q.textContent=e.about,A.src=e.avatar,console.log("getUserInfo",e),F=e._id})).catch((function(e){console.log(e)})),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){J(e,"append")}))})).catch((function(e){console.log(e)})),U.addEventListener("click",(function(){T.value=A.src,r(O)})),w.addEventListener("click",(function(){c(O)})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),B.textContent="Сохранение...",(t={avatar:T.value},fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){A.src=e.avatar,c(O),B.textContent="Сохранить"})).catch((function(e){console.log(e),B.textContent="Сохранить"}))})),p.addEventListener("click",(function(){L.value=C.textContent,E.value=q.textContent,r(m)})),x.addEventListener("click",(function(){c(m)})),m.addEventListener("submit",(function(e){var t;e.preventDefault(),g.textContent="Сохранение...",(t={name:L.value,about:E.value},fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){C.textContent=e.name,q.textContent=e.about,c(m),g.textContent="Сохранить"})).catch((function(e){console.log(e),g.textContent="Сохранить"}))})),P.addEventListener("click",(function(){c(b)})),f.addEventListener("click",(function(){r(_)})),j.addEventListener("click",(function(){c(_)})),_.addEventListener("submit",(function(e){var n;e.preventDefault(),y.textContent="Сохранение...",(n={name:v.value,link:h.value},fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){J(e,"prepend"),c(_),v.value="",h.value="",t("add",!0,y,"popup__submit-button_inactive"),y.textContent="Создать"})).catch((function(e){console.log(e),y.textContent="Создать"}))})),_.addEventListener("click",(function(e){a(e,_)})),m.addEventListener("click",(function(e){a(e,m)})),b.addEventListener("click",(function(e){a(e,b)})),O.addEventListener("click",(function(e){a(e,O)})),M={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__message-error_active"},Array.from(document.querySelectorAll(M.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n(e,o,r),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,c),n(e,o,r)}))}))}(M,e)}))})();