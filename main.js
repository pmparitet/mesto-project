(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Ov:()=>V,xS:()=>F});var t=function(e,t,n,o){switch(n.disabled=t,e){case"add":n.classList.add(o);break;case"remove":n.classList.remove(o);break;default:console.log("changeButtonClass-default")}},n=function(e,n,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?t("remove",!1,o,e.inactiveButtonClass):t("add",!0,o,e.inactiveButtonClass)},o=document.querySelector("#card-template").content,r=document.querySelector(".elements"),c=document.querySelector(".main"),u=c.querySelector(".profile__edit-button"),a=c.querySelector(".profile__add-button"),i=document.querySelector("#editForm"),l=document.querySelector("#addCardForm"),s=l.querySelector(".popup__field[name='nameInput']"),d=l.querySelector(".popup__field[name='urlInput']"),p=l.querySelector(".popup__submit-button"),f=c.querySelector(".profile__title"),_=c.querySelector(".profile__subtitle"),m=i.querySelector(".popup__field[name='nameInput']"),v=i.querySelector(".popup__field[name='jobeInput']"),h=document.querySelector("#img-popup"),y=h.querySelector(".popup__image"),b=h.querySelector(".popup__image-name"),S=c.querySelector(".profile__overlay"),q=S.querySelector(".profile__avatar"),C=document.querySelector("#editAvatar"),k=C.querySelector(".popup__field[name='avatarUrlInput']"),L=C.querySelector(".popup__close-button"),E=C.querySelector(".popup__submit-button"),g=i.querySelector(".popup__submit-button"),x=i.querySelector(".popup__close-button"),U=l.querySelector(".popup__close-button"),A=h.querySelector(".popup__close-button");function O(e){"Escape"===e.key&&T(document.querySelector(".popup_opened"))}function P(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O)}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)}function j(e,t){e.target.classList.contains("popup_opened")&&T(t)}var w={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"f573e011-92da-4150-bd2f-6bf7fb5dd4b1","Content-Type":"application/json"}},B=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},D=function(e){return fetch("".concat(w.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:w.headers}).then((function(e){return B(e)}))},I=function(e){return fetch("".concat(w.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:w.headers}).then((function(e){return B(e)}))},N=function(e){return fetch("".concat(w.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:w.headers}).then((function(e){return B(e)}))};function J(e){e.classList.add("element__like-btn_active")}var M,F="";function H(e,t){var n=function(e){var t=o.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__mask-group"),r=t.querySelector(".element__title"),c=t.querySelector(".element__like-btn"),u=t.querySelector(".element__delete-btn"),a=t.querySelector(".element__like-count");return n.setAttribute("src",e.link),n.setAttribute("alt",e.name),r.textContent=e.name,a.textContent=e.likes.length,function(e){return e.likes.map((function(e){return e._id})).includes(F)}(e)&&J(c),c.addEventListener("click",(function(){c.classList.contains("element__like-btn_active")?function(e,t,n){N(e).then((function(e){!function(e){e.classList.remove("element__like-btn_active")}(t),n.textContent=e.likes.length})).catch((function(e){console.log(e,t)}))}(e._id,c,a):function(e,t,n){I(e).then((function(e){J(t),n.textContent=e.likes.length})).catch((function(e){console.log(e,t)}))}(e._id,c,a)})),F===e.owner._id?u.addEventListener("click",(function(){D(e._id).then((function(){t.remove()})).catch((function(e){console.log(e)}))})):u.classList.add("element__delete-btn_hidden"),n.addEventListener("click",(function(){V(n,r)})),t}(e);switch(t){case"append":r.append(n);break;case"prepend":r.prepend(n)}}function V(e,t){y.src="",y.alt="",b.textContent="",y.src=e.src,y.alt=e.alt,b.textContent=t.textContent,P(h)}fetch("".concat(w.baseUrl,"/users/me"),{headers:w.headers}).then((function(e){return B(e)})).then((function(e){f.textContent=e.name,_.textContent=e.about,q.src=e.avatar,F=e._id,fetch("".concat(w.baseUrl,"/cards"),{headers:w.headers}).then((function(e){return B(e)})).then((function(e){e.forEach((function(e){H(e,"append")}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),S.addEventListener("click",(function(){k.value=q.src,P(C)})),L.addEventListener("click",(function(){T(C)})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),E.textContent="Сохранение...",(t={avatar:k.value},fetch("".concat(w.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:w.headers,body:JSON.stringify(t)}).then((function(e){return B(e)}))).then((function(e){q.src=e.avatar,T(C)})).catch((function(e){console.log(e)})).finally((function(){return E.textContent="Сохранить"}))})),u.addEventListener("click",(function(){m.value=f.textContent,v.value=_.textContent,P(i)})),x.addEventListener("click",(function(){T(i)})),i.addEventListener("submit",(function(e){var t;e.preventDefault(),g.textContent="Сохранение...",(t={name:m.value,about:v.value},fetch("".concat(w.baseUrl,"/users/me"),{method:"PATCH",headers:w.headers,body:JSON.stringify(t)}).then((function(e){return B(e)}))).then((function(e){f.textContent=e.name,_.textContent=e.about,T(i)})).catch((function(e){console.log(e)})).finally((function(){return g.textContent="Сохранить"}))})),A.addEventListener("click",(function(){T(h)})),a.addEventListener("click",(function(){P(l)})),U.addEventListener("click",(function(){T(l)})),l.addEventListener("submit",(function(e){var n;e.preventDefault(),p.textContent="Сохранение...",(n={name:s.value,link:d.value},fetch("".concat(w.baseUrl,"/cards"),{method:"POST",headers:w.headers,body:JSON.stringify(n)}).then((function(e){return B(e)}))).then((function(e){H(e,"prepend"),T(l),s.value="",d.value="",t("add",!0,p,"popup__submit-button_inactive")})).catch((function(e){console.log(e)})).finally((function(){return p.textContent="Создать"}))})),l.addEventListener("click",(function(e){j(e,l)})),i.addEventListener("click",(function(e){j(e,i)})),h.addEventListener("click",(function(e){j(e,h)})),C.addEventListener("click",(function(e){j(e,C)})),M={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__message-error_active"},Array.from(document.querySelectorAll(M.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n(e,o,r),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,c),n(e,o,r)}))}))}(M,e)}))})();