(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{O:()=>V});var t=function(e,t,n,o){switch(n.disabled=t,e){case"add":n.classList.add(o);break;case"remove":n.classList.remove(o);break;default:console.log("changeButtonClass-default")}},n=function(e,n,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?t("remove",!1,o,e.inactiveButtonClass):t("add",!0,o,e.inactiveButtonClass)},o="",r=document.querySelector("#card-template").content,c=document.querySelector(".elements"),u=document.querySelector(".main"),a=u.querySelector(".profile__edit-button"),i=u.querySelector(".profile__add-button"),l=document.querySelector("#editForm"),s=document.querySelector("#addCardForm"),d=s.querySelector(".popup__field[name='nameInput']"),p=s.querySelector(".popup__field[name='urlInput']"),f=s.querySelector(".popup__submit-button"),_=u.querySelector(".profile__title"),m=u.querySelector(".profile__subtitle"),v=l.querySelector(".popup__field[name='nameInput']"),h=l.querySelector(".popup__field[name='jobeInput']"),y=document.querySelector("#img-popup"),b=y.querySelector(".popup__image"),S=y.querySelector(".popup__image-name"),q=u.querySelector(".profile__overlay"),C=q.querySelector(".profile__avatar"),k=document.querySelector("#editAvatar"),L=k.querySelector(".popup__field[name='avatarUrlInput']"),E=k.querySelector(".popup__close-button"),g=k.querySelector(".popup__submit-button"),x=l.querySelector(".popup__submit-button"),U=l.querySelector(".popup__close-button"),A=s.querySelector(".popup__close-button"),O=y.querySelector(".popup__close-button");function P(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))}function T(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P)}function j(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P)}function w(e,t){e.target.classList.contains("popup_opened")&&j(t)}var B,D={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"f573e011-92da-4150-bd2f-6bf7fb5dd4b1","Content-Type":"application/json"}},I=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},N=function(e){return fetch("".concat(D.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:D.headers}).then((function(e){return I(e)}))},J=function(e){return fetch("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:D.headers}).then((function(e){return I(e)}))},M=function(e){return fetch("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:D.headers}).then((function(e){return I(e)}))};function F(e){e.classList.add("element__like-btn_active")}function H(e,t){var n=function(e){var t=r.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__mask-group"),c=t.querySelector(".element__title"),u=t.querySelector(".element__like-btn"),a=t.querySelector(".element__delete-btn"),i=t.querySelector(".element__like-count");return n.setAttribute("src",e.link),n.setAttribute("alt",e.name),c.textContent=e.name,i.textContent=e.likes.length,function(e){return e.likes.map((function(e){return e._id})).includes(o)}(e)&&F(u),u.addEventListener("click",(function(){u.classList.contains("element__like-btn_active")?function(e,t,n){M(e).then((function(e){!function(e){e.classList.remove("element__like-btn_active")}(t),n.textContent=e.likes.length})).catch((function(e){console.log(e,t)}))}(e._id,u,i):function(e,t,n){J(e).then((function(e){F(t),n.textContent=e.likes.length})).catch((function(e){console.log(e,t)}))}(e._id,u,i)})),o===e.owner._id?a.addEventListener("click",(function(){N(e._id).then((function(){t.remove()})).catch((function(e){console.log(e)}))})):a.classList.add("element__delete-btn_hidden"),n.addEventListener("click",(function(){V(n,c)})),t}(e);switch(t){case"append":c.append(n);break;case"prepend":c.prepend(n)}}function V(e,t){b.src="",b.alt="",S.textContent="",b.src=e.src,b.alt=e.alt,S.textContent=t.textContent,T(y)}fetch("".concat(D.baseUrl,"/users/me"),{headers:D.headers}).then((function(e){return I(e)})).then((function(e){_.textContent=e.name,m.textContent=e.about,C.src=e.avatar,o=e._id,fetch("".concat(D.baseUrl,"/cards"),{headers:D.headers}).then((function(e){return I(e)})).then((function(e){e.forEach((function(e){H(e,"append")}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),q.addEventListener("click",(function(){L.value=C.src,T(k)})),E.addEventListener("click",(function(){j(k)})),k.addEventListener("submit",(function(e){var t;e.preventDefault(),g.textContent="Сохранение...",(t={avatar:L.value},fetch("".concat(D.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:D.headers,body:JSON.stringify(t)}).then((function(e){return I(e)}))).then((function(e){C.src=e.avatar,j(k)})).catch((function(e){console.log(e)})).finally((function(){return g.textContent="Сохранить"}))})),a.addEventListener("click",(function(){v.value=_.textContent,h.value=m.textContent,T(l)})),U.addEventListener("click",(function(){j(l)})),l.addEventListener("submit",(function(e){var t;e.preventDefault(),x.textContent="Сохранение...",(t={name:v.value,about:h.value},fetch("".concat(D.baseUrl,"/users/me"),{method:"PATCH",headers:D.headers,body:JSON.stringify(t)}).then((function(e){return I(e)}))).then((function(e){_.textContent=e.name,m.textContent=e.about,j(l)})).catch((function(e){console.log(e)})).finally((function(){return x.textContent="Сохранить"}))})),O.addEventListener("click",(function(){j(y)})),i.addEventListener("click",(function(){T(s)})),A.addEventListener("click",(function(){j(s)})),s.addEventListener("submit",(function(e){var n;e.preventDefault(),f.textContent="Сохранение...",(n={name:d.value,link:p.value},fetch("".concat(D.baseUrl,"/cards"),{method:"POST",headers:D.headers,body:JSON.stringify(n)}).then((function(e){return I(e)}))).then((function(e){H(e,"prepend"),j(s),d.value="",p.value="",t("add",!0,f,"popup__submit-button_inactive")})).catch((function(e){console.log(e)})).finally((function(){return f.textContent="Создать"}))})),s.addEventListener("click",(function(e){w(e,s)})),l.addEventListener("click",(function(e){w(e,l)})),y.addEventListener("click",(function(e){w(e,y)})),k.addEventListener("click",(function(e){w(e,k)})),B={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__message-error_active"},Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){!function(e,t){var o=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n(e,o,r),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,c),n(e,o,r)}))}))}(B,e)}))})();